<?xml version="1.0" encoding="utf-8"?>
<project basedir="." default="doAll" name="schemas">

  <!-- note: following properties are passed as parameters via Oxygen:
      -${pd}:  current project directory path (i.e. where the ise.xpr file lives)
      -${teiFramework}:  path to the active TEI Framework directory
  -->

  <property name="echo.separator" value="************************************************"/>
<!--  This is an incoming parameter on the command line which supplies the path of a file 
     which is going to be used to create the valList for the sp/@who attribute. It's a TEI 
     file which has a <particDesc>. -->
  <property name="sourceParticDescFile" value="${sourceParticDescFile}"/>

  <target name="createSchemas">
    <echo message="${echo.separator}"/>
    <echo message="Create ODD files for three schema levels."/>
    <java classname="net.sf.saxon.Transform">
      <arg value="-s:${pd}/schemas/ise_root.odd"/>
      <arg value="-xsl:${pd}/xsl/build_ise_schemas.xsl"/> 
      <arg value="sourceParticDescFile=${sourceParticDescFile}"/>
    </java>
    
    <echo message="${echo.separator}"/>
    <echo message="Create schemas from ODD files."/>
    <echo message="Using this as defaultSource: ${teiFramework}/xml/tei/odd/p5subset.xml"/>
    <echo message="Using this as inputFile: ${pd}/schemas/ise_full.odd"/>
    <ant antfile="${teiFramework}/xml/tei/stylesheet/relaxng/build-to.xml" dir="${teiFramework}/xml/tei/stylesheet/relaxng">
      <property name="defaultSource" value="${teiFramework}/xml/tei/odd/p5subset.xml"/>
      <property name="inputFile" value="${pd}/schemas/ise_full.odd"/>
      <property name="outputFile" value="${pd}/schemas/ise_full.rng"/>
      <property name="profile" value="default"/>
      <property name="lang" value="en"/>
    </ant>
    
    <ant antfile="${teiFramework}/xml/tei/stylesheet/relaxng/build-to.xml" dir="${teiFramework}/xml/tei/stylesheet/relaxng">
      <property name="defaultSource" value="${teiFramework}/xml/tei/odd/p5subset.xml"/>
      <property name="inputFile" value="${pd}/schemas/ise_intermediate.odd"/>
      <property name="outputFile" value="${pd}/schemas/ise_intermediate.rng"/>
    </ant>
    
    <ant antfile="${teiFramework}/xml/tei/stylesheet/relaxng/build-to.xml" dir="${teiFramework}/xml/tei/stylesheet/relaxng">
      <property name="defaultSource" value="${teiFramework}/xml/tei/odd/p5subset.xml"/>
      <property name="inputFile" value="${pd}/schemas/ise_basic.odd"/>
      <property name="outputFile" value="${pd}/schemas/ise_basic.rng"/>
    </ant>
  </target>
  
<!--  <target name="cleanup">
    <echo message="${echo.separator}"/>
    <echo message="Clean up some stuff."/>
    <delete>
      <fileset dir="${pd}/schemas" casesensitive="yes">
        <include name="*.odd"/>
        <include name="*.rng"/>
        <exclude name="ise_root.odd"/>
      </fileset>
    </delete>
  </target>-->
  
  
  <target name="doAll">
    <antcall target="createSchemas"/>
    <!--<antcall target="cleanup"/>-->
  </target>

</project>